# Rule Builder

조건 → 동작 자동화 규칙을 생성하고 관리하는 Rule Builder에 대해 설명합니다.

## 개요

Rule Builder는 사용자가 직관적인 인터페이스를 통해 자동화 규칙을 생성하고 관리할 수 있는 시스템입니다.

## 규칙 구조

### 1. 기본 규칙 구조

#### IF-THEN 구조
```
IF (조건) THEN (동작)
```

#### 예시
- IF 온도 > 30℃ THEN 환기팬 ON
- IF 토양 수분 < 20% THEN 관수 시작
- IF CO₂ < 800ppm THEN CO₂ 공급 ON

### 2. 복합 조건

#### AND 조건
```
IF (조건1) AND (조건2) THEN (동작)
```

#### 예시
- IF 온도 > 30℃ AND 습도 > 70% THEN 환기팬 ON
- IF 토양 수분 < 20% AND 시간 = 06:00~18:00 THEN 관수 시작

#### OR 조건
```
IF (조건1) OR (조건2) THEN (동작)
```

#### 예시
- IF 온도 > 35℃ OR 습도 > 80% THEN 환기팬 ON
- IF 토양 수분 < 15% OR 작물 스트레스 > 80 THEN 관수 시작

#### NOT 조건
```
IF NOT (조건) THEN (동작)
```

#### 예시
- IF NOT 시간 = 22:00~06:00 THEN 인공광 ON
- IF NOT 환기팬 ON THEN CO₂ 공급 ON

### 3. 복합 동작

#### 다중 동작
```
IF (조건) THEN (동작1) AND (동작2)
```

#### 예시
- IF 온도 > 30℃ THEN 환기팬 ON AND 차광 스크린 닫기
- IF 토양 수분 < 20% THEN 관수 시작 AND 알람 발생

#### 순차 동작
```
IF (조건) THEN (동작1) THEN (동작2)
```

#### 예시
- IF 관수 시작 THEN 펌프 ON THEN 10분 후 펌프 OFF

## 조건 타입

### 1. 센서 조건

#### 환경 센서
- **온도**: 온도 값 비교 (>, <, =, >=, <=)
- **습도**: 습도 값 비교
- **CO₂**: CO₂ 농도 비교
- **조도**: 조도 값 비교

#### 작물 센서
- **토양 수분**: 토양 수분 함량 비교
- **토양 EC**: 토양 EC 값 비교
- **엽면 습도**: 엽면 습도 값 비교
- **줄기 직경**: 줄기 직경 값 비교

### 2. 시간 조건

#### 시간대
- **특정 시간**: 특정 시간 (예: 06:00)
- **시간 범위**: 시간 범위 (예: 06:00~18:00)
- **요일**: 특정 요일 (예: 월요일)
- **날짜**: 특정 날짜 (예: 2024-01-15)

#### 예시
- IF 시간 = 06:00 THEN 인공광 OFF
- IF 시간 = 06:00~18:00 THEN 인공광 보조
- IF 요일 = 월요일 THEN 정기 점검 알람

### 3. 상태 조건

#### 장치 상태
- **ON/OFF**: 장치 ON/OFF 상태
- **값**: 장치 현재 값 (예: 팬 속도)

#### 예시
- IF 환기팬 ON THEN CO₂ 공급 OFF
- IF 난방기 ON AND 온도 > 목표온도 THEN 난방기 OFF

### 4. AI 분석 조건

#### AI 분석 결과
- **생육 상태**: AI 분석 기반 생육 상태
- **병충해 탐지**: 병충해 탐지 여부
- **스트레스 지수**: 작물 스트레스 지수

#### 예시
- IF 병충해 탐지 = 진딧물 THEN 방제 로봇 실행
- IF 작물 스트레스 > 80 THEN 관수 시작

## 동작 타입

### 1. 장치 제어

#### 환경 제어 장치
- **난방기**: 난방기 ON/OFF, 온도 설정
- **환기팬**: 환기팬 ON/OFF, 속도 설정
- **스크린**: 스크린 열기/닫기, 개폐율 설정
- **CO₂ 공급**: CO₂ 공급 ON/OFF, 유량 설정
- **가습기/제습기**: 가습/제습 ON/OFF
- **인공광**: 인공광 ON/OFF, 밝기 설정

#### 관수 시스템
- **관수 밸브**: 관수 밸브 ON/OFF
- **관수 펌프**: 관수 펌프 ON/OFF
- **관수량**: 관수량 설정

### 2. 로봇 제어

#### 로봇 작업
- **방제 로봇**: 방제 로봇 작업 실행
- **수확 로봇**: 수확 로봇 작업 실행
- **운반 로봇**: 운반 로봇 작업 실행

### 3. 알람 및 알림

#### 알람
- **알람 발생**: 알람 발생
- **이메일 알림**: 이메일 알림 전송
- **SMS 알림**: SMS 알림 전송
- **푸시 알림**: 모바일 푸시 알림

### 4. 데이터 기록

#### 로그 기록
- **이벤트 로그**: 이벤트 로그 기록
- **데이터 저장**: 특정 데이터 저장
- **리포트 생성**: 리포트 자동 생성

## 규칙 우선순위

### 1. 우선순위 설정

#### 우선순위 레벨
- **높음**: 높은 우선순위 (안전 관련)
- **중간**: 중간 우선순위 (일반 제어)
- **낮음**: 낮은 우선순위 (최적화)

#### 우선순위 적용
- **충돌 시**: 우선순위가 높은 규칙 우선 실행
- **동시 실행**: 여러 규칙 동시 실행 가능
- **상호 배제**: 상호 배제되는 규칙 처리

### 2. 규칙 그룹

#### 그룹 관리
- **그룹 생성**: 규칙 그룹 생성
- **그룹 활성화/비활성화**: 그룹 단위 활성화/비활성화
- **그룹 우선순위**: 그룹 단위 우선순위 설정

## 규칙 관리

### 1. 규칙 생성

#### 생성 방법
- **시각적 빌더**: 드래그 앤 드롭 방식
- **코드 편집**: 코드로 직접 작성
- **템플릿**: 미리 정의된 템플릿 사용

#### 규칙 검증
- **구문 검증**: 규칙 구문 검증
- **의미 검증**: 규칙 의미 검증
- **충돌 검사**: 다른 규칙과의 충돌 검사

### 2. 규칙 수정

#### 수정 방법
- **편집**: 규칙 편집
- **복사**: 규칙 복사
- **삭제**: 규칙 삭제

### 3. 규칙 실행

#### 실행 모드
- **자동 실행**: 조건 만족 시 자동 실행
- **수동 실행**: 사용자가 수동으로 실행
- **테스트 실행**: 테스트 모드로 실행

#### 실행 이력
- **실행 로그**: 규칙 실행 이력 기록
- **실행 통계**: 규칙 실행 통계
- **효과 분석**: 규칙 실행 효과 분석

## 규칙 예시

### 1. 기본 규칙

```
규칙 1: 고온 시 환기
IF 온도 > 30℃ THEN 환기팬 ON

규칙 2: 저습도 시 가습
IF 습도 < 40% THEN 가습기 ON

규칙 3: 저CO₂ 시 공급
IF CO₂ < 800ppm THEN CO₂ 공급 ON
```

### 2. 복합 규칙

```
규칙 4: 고온 고습 시 환기
IF 온도 > 30℃ AND 습도 > 70% THEN 환기팬 ON

규칙 5: 낮 시간대 관수
IF 토양 수분 < 20% AND 시간 = 06:00~18:00 THEN 관수 시작

규칙 6: 병충해 탐지 시 방제
IF 병충해 탐지 = 진딧물 THEN 방제 로봇 실행 AND 알람 발생
```

### 3. 시간 기반 규칙

```
규칙 7: 아침 인공광 끄기
IF 시간 = 06:00 THEN 인공광 OFF

규칙 8: 저녁 보온
IF 시간 = 18:00 THEN 보온 스크린 닫기

규칙 9: 야간 최소 환기
IF 시간 = 22:00~06:00 AND 온도 > 15℃ THEN 환기팬 최소 속도
```

## 관련 문서

- [환경 제어](./environment-control.mdx)
- [온실 자동화](./greenhouse-automation.mdx)
- [액추에이터 제어](./actuator-control.mdx)

