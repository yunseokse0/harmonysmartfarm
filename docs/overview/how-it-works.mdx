# 작동 원리

하모니 스마트팜 솔루션의 전체 작동 프로세스를 단계별로 설명합니다.

## 전체 프로세스 흐름

### 1. 센서 데이터 수집

- **환경 센서**: 온도, 습도, CO₂, 조도 등 실시간 측정
- **작물 센서**: 토양 수분, EC, 엽면 습도 등 작물 상태 측정
- **이미지 센서**: 카메라를 통한 작물 이미지 수집
- **수집 주기**: 센서별로 설정 가능 (기본 1분 ~ 1시간)

### 2. 데이터 처리 및 저장

- **Gateway 전송**: 센서 데이터를 Gateway를 통해 클라우드로 전송
- **데이터 검증**: 수집된 데이터의 유효성 검사
- **데이터베이스 저장**: Time-series DB에 저장 (InfluxDB, TimescaleDB 등)
- **전처리**: 노이즈 제거, 이상치 처리

### 3. AI 분석 엔진 실행

- **이미지 분석**: 카메라 이미지를 AI 모델에 입력하여 분석
  - 생육 상태 판별
  - 질병 탐지
  - 스트레스 상태 분석
- **데이터 분석**: 시계열 데이터 분석 및 패턴 인식
- **예측 모델**: 생육 예측, 수확량 예측
- **결과 생성**: 분석 결과 및 추천 사항 생성

### 4. 자동 제어 규칙 실행

- **규칙 평가**: Rule Builder에서 정의한 규칙들을 순차적으로 평가
- **조건 확인**: 센서 데이터와 규칙 조건 비교
- **액추에이터 제어**: 조건 만족 시 해당 액추에이터 제어
  - 예: 온도 > 30℃ → 환기팬 ON
  - 예: 토양 수분 < 20% → 관수 시작
- **로봇 제어**: 필요 시 로봇 시스템에 작업 명령 전송

### 5. Dashboard에 실시간 표시

- **데이터 시각화**: 수집된 센서 데이터를 그래프, 게이지 등으로 표시
- **상태 표시**: 각 시스템의 현재 상태 표시
- **알람 표시**: 임계값 초과 시 알람 표시 및 알림
- **제어 인터페이스**: 사용자가 수동으로 제어할 수 있는 인터페이스 제공

## 실시간 처리 예시

```
[센서] → [Gateway] → [Cloud] → [DB 저장]
                              ↓
[AI 분석] ← [데이터 조회] ← [DB]
    ↓
[분석 결과] → [규칙 평가] → [제어 명령] → [액추에이터/로봇]
    ↓
[Dashboard 업데이트] ← [상태 반영]
```

## 예외 처리

- **센서 오류**: 센서 데이터 수신 실패 시 알람 발생
- **통신 오류**: Gateway와의 통신 단절 시 재연결 시도
- **제어 실패**: 액추에이터 제어 실패 시 재시도 및 알람
- **AI 분석 오류**: 분석 실패 시 이전 결과 유지 또는 기본값 사용

## 관련 문서

- [데이터 흐름 상세](../sensors/data-flow.mdx)
- [AI 분석 엔진](../ai-automation/ai-crop-analysis.mdx)
- [Rule Builder](../control-system/rule-builder.mdx)
- [Dashboard](../ui/dashboard.mdx)

