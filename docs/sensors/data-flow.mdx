# 데이터 흐름

하모니 스마트팜 솔루션에서 센서 데이터가 수집부터 Dashboard 표시까지 이르는 전체 흐름을 설명합니다.

## 데이터 흐름 개요

```
[센서] → [Gateway] → [Cloud] → [DB] → [Dashboard]
           ↓           ↓         ↓
        [로컬 저장]  [처리]   [분석]
```

## 단계별 상세 설명

### 1. 센서 데이터 수집

#### 센서 레벨
- **측정**: 물리적/화학적 값 측정
- **디지털 변환**: 아날로그 신호를 디지털 값으로 변환
- **로컬 저장**: 일시적 버퍼 저장 (통신 단절 대비)

#### 통신 프로토콜
- **LoRa**: 장거리 저전력 통신
- **WiFi**: 고속 데이터 전송
- **Zigbee**: 메시 네트워크
- **Modbus**: 산업용 시리얼 통신
- **MQTT**: 경량 메시징 프로토콜

### 2. Gateway 전송

#### Gateway 역할
- **데이터 집계**: 여러 센서 데이터 수집
- **프로토콜 변환**: 센서 프로토콜 → 클라우드 프로토콜
- **로컬 처리**: 기본 필터링 및 검증
- **버퍼링**: 통신 단절 시 임시 저장

#### 전송 방식
- **실시간 전송**: 중요 데이터 즉시 전송
- **배치 전송**: 주기적 일괄 전송
- **압축**: 대용량 데이터 압축 전송

### 3. Cloud 처리

#### 수신 및 검증
- **데이터 수신**: Gateway로부터 데이터 수신
- **형식 검증**: 데이터 형식 및 범위 검증
- **중복 제거**: 중복 데이터 제거

#### 전처리
- **노이즈 제거**: 이상치 및 노이즈 필터링
- **보정 적용**: 센서 보정 값 적용
- **단위 변환**: 표준 단위로 변환
- **타임스탬프 추가**: 수집 시간 기록

### 4. 데이터베이스 저장

#### 데이터베이스 타입
- **Time-series DB**: 시계열 데이터 최적화
  - InfluxDB
  - TimescaleDB
  - Prometheus
- **관계형 DB**: 메타데이터 및 설정 저장
  - PostgreSQL
  - MySQL

#### 저장 구조
- **Raw Data**: 원본 센서 데이터
- **Aggregated Data**: 집계된 데이터 (분/시/일 단위)
- **Metadata**: 센서 정보, 위치, 설정 등

#### 데이터 보관
- **실시간 데이터**: 최근 30일 보관
- **집계 데이터**: 장기 보관 (1년 이상)
- **백업**: 정기적 백업 수행

### 5. 데이터 분석 및 처리

#### 실시간 분석
- **스트리밍 처리**: 실시간 데이터 스트림 처리
- **임계값 확인**: 알람 조건 평가
- **트렌드 분석**: 단기 트렌드 계산

#### 배치 분석
- **집계 계산**: 통계 값 계산 (평균, 최대, 최소 등)
- **패턴 인식**: 이상 패턴 탐지
- **예측 모델**: 머신러닝 모델 실행

### 6. Dashboard 표시

#### 데이터 조회
- **API 호출**: Dashboard에서 API를 통해 데이터 조회
- **실시간 업데이트**: WebSocket 또는 폴링을 통한 실시간 업데이트
- **캐싱**: 자주 조회되는 데이터 캐싱

#### 시각화
- **그래프**: 시계열 그래프, 막대 그래프 등
- **게이지**: 현재 값 게이지 표시
- **맵**: 센서 위치 표시
- **테이블**: 데이터 테이블 표시

## 데이터 흐름 예시

### 예시: 온도 센서 데이터

```
1. DS18B20 센서 측정: 25.3℃
   ↓
2. LoRa 통신으로 Gateway 전송
   ↓
3. Gateway에서 MQTT로 Cloud 전송
   ↓
4. Cloud에서 데이터 검증 및 전처리
   ↓
5. InfluxDB에 저장 (timestamp: 2024-01-15 10:30:00, value: 25.3)
   ↓
6. 실시간 분석: 임계값 확인 (25.3 < 30℃ → 정상)
   ↓
7. Dashboard API 호출 → 데이터 조회
   ↓
8. React 컴포넌트에서 그래프 업데이트
```

## 통신 단절 처리

### Gateway 레벨
- **로컬 버퍼**: 통신 단절 시 로컬에 임시 저장
- **재연결 시도**: 주기적 재연결 시도
- **복구 후 전송**: 연결 복구 시 누락 데이터 전송

### Cloud 레벨
- **타임아웃 처리**: 일정 시간 미수신 시 알람
- **데이터 보간**: 누락 데이터 보간 (선택적)
- **상태 모니터링**: Gateway 연결 상태 모니터링

## 성능 최적화

### 데이터 압축
- **로스리스 압축**: 정확도 유지 압축
- **로시 압축**: 근사치 허용 압축

### 배치 처리
- **일괄 전송**: 여러 데이터를 묶어 전송
- **주기 조절**: 중요도에 따른 전송 주기 조절

### 캐싱
- **로컬 캐싱**: 자주 조회되는 데이터 캐싱
- **CDN 활용**: 정적 데이터 CDN 배포

## 관련 문서

- [환경 센서](./environment-sensors.mdx)
- [작물 센서](./crop-sensors.mdx)
- [Monitoring](../ui/monitoring.mdx)

